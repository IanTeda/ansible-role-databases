# ============================================================================
# MongoDB Configuration File (Ansible managed) - Build Role
# Comprehensive config for source-built MongoDB
# ============================================================================
# ⚠️ WARNING: This file is managed by Ansible - DO NOT EDIT MANUALLY!       ⚠️
# Any manual changes will be overwritten on the next Ansible run.
# Edit the template file or Ansible variables instead.
#
# Template path: roles/databases/templates/mongodb-build.conf.j2
# Deploy path: {{ mongodb_config_file }}
# Last deployed: {{ ansible_date_time.iso8601 }}
# =============================================================================
#
# This configuration file is optimized for MongoDB built from source.
# It includes security hardening and performance optimizations.
#
# Generated by Ansible on {{ ansible_date_time.iso8601 }}
# Host: {{ ansible_fqdn }}
# ------------------------------------------------------------------------------

# Where to store data.
storage:
  dbPath: {{ mongodb_data_dir }}
  journal:
    enabled: true
  wiredTiger:
    engineConfig:
      cacheSizeGB: {{ mongodb_cache_size_gb | default(1) }}

# Where to log.
systemLog:
  destination: syslog
  logAppend: true
  logRotate: reopen

# Network interfaces.
net:
  bindIp: {{ mongodb_listen_address }}
  port: {{ mongodb_port }}
{% if mongodb_enable_tls | default(false) %}
  tls:
    mode: requireTLS
    certificateKeyFile: {{ mongodb_tls_cert_file }}
    CAFile: {{ mongodb_tls_ca_file }}
{% endif %}

# Security settings
security:
  authorization: {{ 'enabled' if mongodb_enable_auth | default(false) else 'disabled' }}
{% if mongodb_enable_auth | default(false) %}
  keyFile: {{ mongodb_key_file }}
{% endif %}

# Process management
processManagement:
  fork: false
  pidFilePath: /run/{{ mongodb_systemd_name }}/mongod.pid

# Replication (if enabled)
{% if mongodb_replication_enabled | default(false) %}
replication:
  replSetName: {{ mongodb_replica_set_name | default('rs0') }}
{% endif %}

# Sharding (if enabled)
{% if mongodb_sharding_enabled | default(false) %}
sharding:
  clusterRole: {{ mongodb_cluster_role | default('shardsvr') }}
{% endif %}