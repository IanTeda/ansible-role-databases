# ==============================================================================
# Valkey Exporter Prometheus Scraper Configuration
# ==============================================================================
#
# âš ï¸ WARNING: This file is managed by Ansible! âš ï¸
# ğŸ”„ Any manual changes will be overwritten on the next Ansible run
# ğŸ“ To make changes, edit the template file and run the playbook
#
# This Prometheus scraper configuration defines how Prometheus should collect
# metrics from the Valkey Exporter service for monitoring Valkey/Redis instances.
#
# Service Overview:
#   - ğŸ“Š Collects Valkey/Redis performance and health metrics
#   - ğŸ”„ Scrapes metrics every 15 seconds (configurable)
#   - ğŸŒ Connects to Valkey Exporter HTTP endpoint
#   - ğŸ·ï¸ Adds labels for identification and organization
#
# Metrics Categories:
#   - ğŸ’¾ Memory usage (used_memory, max_memory, fragmentation)
#   - ğŸ”— Connection stats (connected_clients, blocked_clients)
#   - ğŸ“Š Command statistics (total_commands_processed, ops_per_sec)
#   - ğŸ’¾ Persistence (last_save_time, changes_since_last_save)
#   - ğŸ”„ Replication (connected_slaves, master_repl_offset)
#   - ğŸƒ Performance (instantaneous_ops_per_sec, hit_rate)
#
# Labels Applied:
#   - job: valkey-exporter
#   - instance: Target address
#   - service: valkey
#   - component: exporter
#
# Security Considerations:
#   ğŸ”’ Metrics endpoint should only be accessible from Prometheus
#   ğŸ“Š Contains database performance information
#   ğŸ›¡ï¸ No authentication - rely on network-level access control
#
# Usage:
#   This file is automatically included in the main Prometheus configuration.
#   Prometheus will discover and scrape the Valkey Exporter endpoint.
#
# References:
#   - Prometheus Configuration: https://prometheus.io/docs/prometheus/latest/configuration/configuration/
#   - Valkey Exporter: https://github.com/oliver006/redis_exporter
#   - Valkey: https://databases_valkey.io/
#
# Managed by: Ansible
# Template: roles/debian/templates/valkey-exporter-scraper.conf.j2
# Last Updated: 2025-07-14
# ==============================================================================

scrape_configs:
  - job_name: 'valkey-exporter'
    static_configs:
      - targets: ['127.0.0.1:{{ databases_valkey.exporter.port }}']
        labels:
          instance: '{{ ansible_fqdn }}'
          service: 'valkey'
          component: 'exporter'
